---
layout: post
title:  "面试"
date:   2018-07-11 12:00:00

categories: Java
tags: learningnote
author: "张学刚"
---

# 介绍下自己（我觉得主要是想听候选人自己的工作项目经验，附带些技术成长经历）

1. IT服务管理系统，主要偏向于工作流，核心技术难点是业务流程和规则较多，因为是做产品积累了扎实的技术基础。
2. POP开放平台，主要负责结算、计费、商家收付费、商家账务、商家发票，对商家返利也有所了解，这两年是技术迅速提高的两年，在分布式系统建设上积累的比较丰富的经验，在系统架构上，也有了更深的认识
3. 7FRESH 生鲜财务系统，设计开发了，计费结算系统、台账系统、退款系统、后面参与了支付网关和支付系统、票据系统的设计，后来仓报价系统、返利系统、票据系统、OAS统被交接给财务系统，进行统一规划。

# 平时关注的java技术有哪些？通过什么样的方式去进一步的学习？

（比如性能，数据建模；然后面试官会对你目前关注的技术进行提问，所以说不要搞一些虚假的东西出来，比如让你分享经典案例，从发现问题到解决问题的全过程）。

1. 代码规范
2. 业务架构
3. 性能提升

1. 阅读优秀的代码，系统的看书，然后把书上的东西应用到实践中，影响身边的人的学习状态，然后大家一起研究交流，互相进步。

# 对自己而已，java技术的擅长点儿是什么？

大型分布式系统的架构经验，利用成熟的分布式技术，服务于业务方案。

# 请介绍一下自己做过的最好的（最满意的，最有收获的，承担职责最重的等）项目（面试官会根据你的项目情况，深入挖掘细致的技术问题）？

1. 在生鲜项目组基于POP开放平台模式积累的经验，摒弃历史包袱，开发了全新的计费结算系统。

这个主要是体现了技术沉淀后的发挥，能够快速发挥，构建一套稳定，高拓展的结算平台

2. 台账和支付、退款系统，在没有任何经验的情况下，分析业务需求，与京东主站交易系统吸取经验，并根据线下店的不同特点，快速构建。

# 就技术本身，你觉得你最擅长最精通最得意的技术点是什么？（由此，面试官会深入与你探讨，看你最擅长的内容掌握的深入是怎样的，这个问题很关键，不懂得不要乱说）？

1. 分布式系统的建设经验、大数据量业务存储的处理方案，数据一致性的保证方式，复杂业务的抽象能力。内聚复杂，平台化思维。

# 你做过的项目中，最复杂的业务流程是什么，请描述一下？

针对计费结算这个系统，有两方面的复杂性，业务的逻辑复杂、数据量大，因为计费是订单*SKU数量*产生的费用(货款、佣金、配送费)

## 业务逻辑复杂

计费结算系统，负责承载京东所有 POP 商家(第三方卖家)计费业务，以 及少部分京东自营类计费业务。日均数据量 5 千万。承载虚拟业务如机票、手机充值、拍卖、迪士尼门票等 98 多种业务，承载实物类正逆向计费业务如国内 SOP，FBP，国际购、LOC(本地生活服务/团购)等共 30 种。

业务多，判断计费规则的方式多，比如订单有sendPay来标识业务，但是有时候订单类型又是影响计费的因素，有的是商家标记，这里我们抽象了统一的计费模型，抽象外部业务和计费之间的业务映射关系，将计费平台化。

计费的主体的多样性，比如我们给某个订单计费的时候，是由交易关系来决定的，有可能只是商家卖的、有可能是店里的某个导购员卖的，这样计费的主体可能是商家、导购员，在某些商业场景下，其实商家也有入驻不通门店单独结算的需求，这样计费的主体多样性需要有前瞻的设计。

## 数据存储复杂

业务多，而且商家体量不一样，我们先经过调研，按Mysql单表数据量500万的量进行分布分表的规划，分了32库1024表，大概存储3个月的数据量，数据三个月进行归档，归档的数据存储到HBASE。现在还没有对归档的数据进行放开查询。对于体量特别大的商家，比如彩票的，手机充值的
按天进行分表，按商家标记，路由不通的分表策略。

# 你所做过的**项目中，系统性能方面最大的挑战是什么，你是怎么处理的，处理中遇到的瓶颈的地方是什么？

结算账户是 计费、结算、收付费、发票、依赖的基础数据，每天有针对5000万明细产生数10亿次调用，对账户系统的稳定性提出了很高的要求，
结算账户系统是一个变更频次特别低，非常适合大量使用缓存的地方，我们对当前的缓存做了调研和比较。
从几个方面做了考虑：
1. 首先是性能和稳定性 caffine在读写方面，表现都明显优于guava，concurrentLinkedHashMap
2. 开源社区支持力度和活跃程度
然后是怎样使用，spring cache在这方面做的比较好，提供了统一的AOP注解，对业务系统几乎零侵入，我们基于cache接口实现了自己的二级缓存，数据访问先走Caffeine本地缓存，然后走Redis缓存，最后才穿透数据库。

大数据量的挑战，我们的账务系统，与应用做了分离，是通过binlog的方式，对本业务线条的数据进行拼接，拼接的方式，通过storm集群
消费kafka消息

任务补偿，比如有一些计费数据推送结算的时候，推送失败了，需要有高频的work进行补偿，因为数据是分库分表的，以前只是多线程处理
后面，我们通过设置参数的方式，每台机器设置一个号，然后通过我们的结算账户取模来分配机器执行响应的任务，后面出现过几次问题，就是宕机之后该机器负责数据没有处理的问题，后面看是否需要自己去实现失效转移的功能，调研后，看到elastic-job在失效转移，和任务执行监控方面做的比较完善了，后面经过测试之后，引入了此方案。

# 客户的需求总变，你怎么处理这种情况？

1. 走在业务前面，现在很注重产品化思维，尤其是业务架构师，非常需要业务领域的知识。
2. 然后是识别这些需求，是不是都是合理的
3. 对多边的需求如何进行抽象落地

# 在团队中有没有引入一些新的技术，如果有，遇到的情况是怎样的？

elastic-job失效转移，失效转移是从这个监听器开始的，当zookeeper上有服务器节点被Removed时，触发监听，查询该服务器被分配的任务项
在查询宕机服务器分配的任务项时，先判断该服务器是否可用，如果可用，才继续查询，判断服务器节点是否可用的方法如上，如果服务器节点存在，认为可用，这与上面失效转移监听被触发的条件（服务器节点被removed）相矛盾。

没有转移，我们手动修改了这个功能。

积累的经验，每一个用到的特性，不一定是开源框架最关注的特性，用的原则一定是保证稳定性。每一个用到的特性，要做到充分的验证。

# 面试官会针对简历的项目逐个问，每个项目的业务首先说清楚，然后根据业务设计领域模型，为什么这么设计，有什么好处，还有哪些方面在后续要做、优化、扩展、到面会画架构图，把架构图讲一遍？

# 异地双活解决方案（偏基础建设的问题有很大概率会问，若能回答好这个问题就是加分项）
