---
layout: post
title:  "如何降低代码的圈复杂度"
date:   2018-07-11 12:00:00

categories: tool
tags: archtecture refactoring tool
author: "XueGang Zhang"
image: /images/logo.png
comments: true
published: true
---

#### 背景介绍

对写的文章让人眼前一亮的作者，邀请到群里，并转载其文章。在一个平台中介绍每一个牛人。


不管小型公司还是大型互联网公司，很多项目债台高筑，新功能开发困难。其中一个很大的原因就是代码复杂，可读性差。Sonar开发团队曾上纲上线的戏称开发人员的7宗罪，其中很关键的一条就是“复杂度”。


#### 如何有效地解决代码的圈复杂度来提高代码的可读性？

你好，我是张学刚。

我今天分享的是如何有效地解决代码的圈复杂度来提高代码的可读性？代码可维护性是代码质量的一个重要标准，而复杂度又是可维护性的一个重要指标。那复杂度有没有一个明确的衡量标准，我们又如何去解决代码的圈复杂度呢？今天我在这里和大家聊一下。

#### 圈复杂度的计算方法


##### 点边计算法

圈复杂度的计算方式 ``M = E − N + 2``

E：控制流图中边的数量
N：控制流图中的节点数量

控制流程图就是通过节点和边组成的图形，比如以下几个图形是典型的控制流程图。
你好，我是张学刚。

我今天分享的是如何有效地解决代码的圈复杂度来提高代码的可读性？代码可维护性是代码质量的一个重要标准，而复杂度又是可维护性的一个重要指标。那复杂度有没有一个明确的衡量标准，我们又如何去解决代码的圈复杂度呢？今天我在这里和大家聊一下。

我们先来看一下圈复杂度与代码质量以及测试和维护成本之间的一个关系。

![关系图](/assets/images/pictures/2020-02-20-cyclomatic_complexity/02.jpg?style=centerme)

我们可以看到当圈复杂度，在1-10之间的时候，代码是清晰，结构化的。可测试性比较高，维护成本也比较低。随着圈复杂度的升高，代码的状况开始恶化，当大于30的时候，代码已经逐步变为不可读，维护成本非常高。

那圈复杂度是如何计算的呢，常用的第一种方法叫做点边计算法，它圈复杂度的计算方式 
V(G) = E − N + 2，我们用下边图来解释一下这个公式：

![关系图](/assets/images/pictures/2020-02-20-cyclomatic_complexity/01.png?style=centerme)

其中公式之中的E指的是控制流图中边的数量，N指的是控制流图中的节点数量。这两个图形指的就是控制流图。那我们可以计算一下，第一个控制流图的圈复杂度是：4-4+2=2.

除此之外圈复杂度还有一种更为直观的计算方法，因为圈复杂度实际上体现了“判定条件”的数量，所以圈复杂度实际上就是等于判定节点的数量再加上1。它的计算公式为：V (G) = P + 1
其中判定节点(P)指的是我们常用的分支语句。例如if语句、while语句、case语句等。

那如何来降低圈复杂度呢？


#### 提炼函数

接下来我们重点介绍一些降低圈复杂的方法，我通过工作中常见的代码，来表述一下，如何去降低复杂度，如果你有更好的方法，也欢迎留言跟我交流。在我们的工作中，做业务系统的时候，通过异步消息进行数据传递，是比较常用的一种方式，在我们监听到对端系统的消息的时候，一般会做这几件事情。判断消息是否为空-->转换消息为数据传输对象DTO-->进一步的判断对象的数据是否合法-->进行业务逻辑的处理。这几个典型的步骤，很多童鞋可能用左边图的方式进行处理。这个时候，如果每一个步骤的方法比较复杂的时候，这个总的方法会非常复杂，这个时候，我们可以通过提炼方法的方式，对高内聚的操作，提炼到一个独立的方法中，来分治复杂性。

![关系图](/assets/images/pictures/2020-02-20-cyclomatic_complexity/03.png?style=centerme)
