---
layout: post
title:  "深度解密京东订单履约之旅"
date:   2018-07-11 12:00:00

categories: Java
tags: learningnote
author: "张学刚"
---

`此文件描述核心业务`

# 订单履约中心

>A opc center for order.

## 业务概述

在电子商务企业中，企业通过优质商品、促销核心追求的就是能与消费者进行交易，而订单可以认为是一次交易生命周期的过程，交易开始生成订单，结束的时候完成订单。交易的核心要素也就是订单上的商品信息、发票（增值税发票，还是普通发票）、运费、时效、预约、优惠等等相关内容，都是订单关心的内容，而这些内容如何被正确的跟踪与执行，是OPC系统核心要解决的问题。

本文的内容，是通过京东现有资料整理而成，但是并不代表京东的立场，本书的内容很多也是个人的思考和个人的观点，并非学术性的结论，对于文章的观点，欢迎大家质疑和思考，本书的目的也是想引发大家的思考。

## 系统介绍

### 何为订单履约

![订单履约](https://raw.githubusercontent.com/unionstars/unionstars.github.io/master/assets/images/pictures/2018-09-07-order-opc-business/0003.jpg)

#### 什么叫做订单履约？

从字面上的意思来说，所谓的订单履约就是京东履行和消费者及客户的一个承诺的约定。

#### 为什么叫做订单履约呢？

在京东或者网站上买东西的（即B2C的业务），最终都会生成一张订单。其实，这个订单就是消费者与京东的一个简单的合同，而合同上的东西都是我们履约内容，包括订单上的信息、发票（增值税发票，还是普通发票）、运费是多少、时效、预约、订单上的优惠等等相关内容。

比如，订单预计在前端就会显示你的订单会在什么时间送达。京东现在对于时效来说，有自己的211（2011年开始）——京东在是中国第一家做出211这么一个时效的公司。

#### 何为211？

211就是上午11点前下单。然后当天送达。晚上11点（23点）下单是次日达。
除了211以外，我京东还有次日达，隔日达，还有前年推出的极速达——即411。411即3个小时送达，这个也是刷新了业内的一个预约时效。

#### 何为预约？

预约就是约时间的一个管理，在京东买东西就会发现，京东有一个预约日历。在未来的7天内，可以选择每天3个不同时段来送达，如北京上海等的一些城市，都会支持夜间配送。

#### 关于OFC系统

这些都是京东的订单履约的内容。为了承载这些履约内容，如何把百京东客户的一个诉求，最终以按时的效果交付到用户手中，就产生了一个系统——即OFC（Order Fulfillment Center：订单履约中心）。简单来说，订单履约中心就是连接的用户下单，和订单在库房生产的一个系统。

OFC在什么环节出现呢？其实，正常买东西都是从“网站的注册à搜索商品à选商品购买à仓储生产、物流配送”。其中OFC是在购买和仓储生产这个环节之中的一个履约流程或者履约系统。

直白一点说就是——用户在京东前台选完商品进入购物车，到结算并点击提交订单按钮的时候，就进入了OFC这个环节，直到这个订单由京东实际发给库房（京东自有100个，协同仓+特殊仓可能将近200个）。怎么把京东每天这么多订单量，发给具体的每一个库房——就是OFC在做的事情。

针对OFC系统接下来会详细介绍会这几个环节：订单的拆分、OCS（一个订单金额的计算）、订单的转移、OFW（顶端全程控制）和订单风控。

#### OFC系统框架图

![OFC系统框架图](https://raw.githubusercontent.com/unionstars/unionstars.github.io/master/assets/images/pictures/2018-09-07-order-opc-business/0004.jpg)

这是OFC系统的一个框架图——OFC系统可能是非常技术化的，或者它是技术逻辑很多的一个系统。所以，我简单的展示了一个OFC系统框架图。展示这张图，主要是想让大家了解OFC系统在京东整个大系统里，它的上下游关以及它数据流程的一个走向。在这里，可以看到订单的拆分、订单的转移和订单计划引擎。

其实，上下游交互的系统很多，因为在京东这么一个体量的公司，它的研发有会很多不同的系统，比如Promise系统——这个系统就是客户的承诺，即客户下单的时效是什么样子，是通过Promise系统计算的，这个订单具体什么时间要放给库房也是Promise系统来执行的。它是订单和订单客户和我们实际行动的一个承诺的系统。此外，包括台账系统，订单中间件、分拣、面单和发票，这些都属于OFC的上下游相关的系统，

所以，通过这张图我们可以理解到：OFC是京东的订单相关里最中间的一个环节啊。它上游有前台（即页面），有我的购物车，有我的结算页，有我的交易（即生成订单）；而下游就是实际的生产，即COO环节，如我的WMS，我的TMS。在京东TMS叫做青龙系统，有直接仓配系统。其实，OFC是在中间的一个可以说是隐形的，存在于在所有业务系统中一个系统。

#### OFC系统流程

![OFC系统流程](https://raw.githubusercontent.com/unionstars/unionstars.github.io/master/assets/images/pictures/2018-09-07-order-opc-business/0005.jpg)

聊到OFC流程，这里用了两个图：一个是老流程，一个是新流程。这里，主要就是介绍一下新的流程，该流程于11年上线。图中可以清楚的看到OFC所处于的环节。

新流程主要的一个特点就是——系统会采用一个并行交互的方式。在以前的时候，一个订单下来是串行的：订单下来以后通过订单管道，接着通过OFC拆分，转移，下传，全程数据串行，就会造成的效果就是时效特别长。当时，老刘下一张单子，从下单到这张订单实际传给库房用了两个小时的时间。毫无疑问，这样的客户体验是肯定是不可行的，在京东做什么样的事，永远是客户体验优先！为了解决这个问题（包括应对业务量的不断壮大），我们改造了一个流程——在数据交互时候，提出了‘系统间采用交互服务’的一个方式，即我们所有业务的东西、我们的系统，都是通过拆分服务、转移服务、翻译处理服务等服务都采用并行的一个交互。

现在，我们速度比较快的一张订单，即之前京东一个移动仓的订单为18分钟，而最快的订单还达到过七八分钟——从客户下单到送达客户手中，不到10分钟的时间。而在我们系统端可能就是毫秒级的操作，就直接到仓库了。